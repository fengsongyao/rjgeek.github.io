---
title: 【Single Sign On】Domino平台应用与构异系统实现单点登录
id: 813
categories:
  - 编程语言
date: 2015-12-07 21:15:54
tags:
---

<span style="color: rgb(102, 102, 102); font-size: 10.5pt; line-height: 18pt;">本部分的描述仅适用于单一的</span><span lang="EN-US" style="color: rgb(102, 102, 102); font-size: 10.5pt; line-height: 18pt;">Domino</span><span style="color: rgb(102, 102, 102); font-size: 10.5pt; line-height: 18pt;">平台应用与构异系统实现单点登录。</span><!--more-->

<div class="MsoNormal" align="center" style="margin:0cm;margin-bottom:.0001pt;
text-align:center;line-height:18.0pt;word-break:break-all"><span lang="EN-US" style="font-size:10.5pt;color:#666666">

* * *
</span></div>

**<span lang="EN-US" style="font-size:12.5pt;color:#666666">1.1 Domino LTPA Cookie </span>****<span style="font-size:12.5pt;color:#666666">生成原理<span lang="EN-US"><o:p></o:p></span></span>**

<span style="font-size:10.5pt;color:#666666">在与<span lang="EN-US"> Domino </span>做<span lang="EN-US"> SSO </span>的时候，会使用<span lang="EN-US"> LTPA Token</span>的认证方式，本文描述它的生成原理，通过它我们可以自己编码生成身份认证的<span lang="EN-US"> cookie</span>，实现<span lang="EN-US"> SSO</span>。<span lang="EN-US"><o:p></o:p></span></span>

<span style="font-size:10.5pt;color:#666666">首先，这个<span lang="EN-US"> cookie </span>由以下部分组成：<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span lang="EN-US" style="font-size:10.5pt;
color:#666666">LTPA token </span><span style="font-size:10.5pt;color:#666666">版本（<span lang="EN-US">4</span>字节）<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span style="font-size:10.5pt;color:#666666">创建时间（<span lang="EN-US">8</span>字节）<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span style="font-size:10.5pt;color:#666666">过期时间（<span lang="EN-US">8</span>字节）<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span style="font-size:10.5pt;color:#666666">用户名（可变长度）<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span lang="EN-US" style="font-size:10.5pt;
color:#666666">Domino LTPA </span><span style="font-size:10.5pt;color:#666666">密钥（<span lang="EN-US">20</span>字节）<span lang="EN-US"> <o:p></o:p></span></span>

<span style="font-size:10.5pt;color:#666666">接下来分别说明各部分的具体内容：<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span lang="EN-US" style="font-size:10.5pt;
color:#666666">LTPA token </span><span style="font-size:10.5pt;color:#666666">版本目前<span lang="EN-US"> Domino </span>只有一种值：<span lang="EN-US">0x0001<o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span style="font-size:10.5pt;color:#666666">创建时间为以十六进制方式表示的<span lang="EN-US">Unix time</span>，例如<span lang="EN-US">:2009-04-09 13:52:42 (GMT +8) =
1239256362 = 49DD8D2A</span>。<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span style="font-size:10.5pt;color:#666666">过期时间<span lang="EN-US">=</span>创建时间<span lang="EN-US"> + SSO </span>配置文档的过期时间（<span lang="EN-US">LTPA_TokenExpiration</span>域）<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span style="font-size:10.5pt;color:#666666">用户名为<span lang="EN-US"> Names </span>中用户文档的<span lang="EN-US">FullName</span>域值；如：<span lang="EN-US">Squall Zhong/Digiwin<o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span lang="EN-US" style="font-size:10.5pt;
color:#666666">Domino LTPA </span><span style="font-size:10.5pt;color:#666666">密钥通过<span lang="EN-US"> Base64</span>编码后，保存在<span lang="EN-US"> SSO </span>配置文档的<span lang="EN-US">LTPA_DominoSecret</span>域中<span lang="EN-US"> <o:p></o:p></span></span>

<span lang="EN-US" style="font-size:10.5pt;color:#666666;mso-no-proof:yes">![http://lh6.googleusercontent.com/9aNb90qGxfI2xo079GBnZU70rVkt0VA0PptmOwkXa3lMWTC4NsYGlyN9SSs2KXnf-umJAFKFSBHwUYyHD89laYLElg](http://helloword.1kapp.com/wp-content/uploads/2015/12/wpid-c59a17b582e2766132b0a5b53ed25bca_clip_image0028f801b21-7107-401b-b63b-f58fb8b4f0dd.jpg)</span><span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

<span style="font-size:10.5pt;color:#666666">当然不能将密钥直接发送给浏览器，所以将上述部分合并起来（如上图），计算<span lang="EN-US"> SHA-1 </span>校验和。<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="font-size:10.5pt;color:#666666;
mso-no-proof:yes">![http://lh5.googleusercontent.com/XLW2lNbFKVzFhL7hGYHbYxQFFy9VqrMdND0CRWaPYL8UyKzjOl7cPTiIjY_sJ5mP8QSNeAFZLT-8slUCXqXHKpvGSQ](http://helloword.1kapp.com/wp-content/uploads/2015/12/wpid-c59a17b582e2766132b0a5b53ed25bca_clip_image004612102fd-470a-4576-aa4c-4150baddb29b.jpg)</span><span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

<span style="font-size:10.5pt;color:#666666">然后用<span lang="EN-US"> SHA-1 </span>校验和替换掉<span lang="EN-US"> Domino LTPA </span>密钥，最后再将内容通过<span lang="EN-US"> Base64 </span>编码，形成最终的<span lang="EN-US"> cookie </span>发送给浏览器（如上图）。这样如果<span lang="EN-US"> cookie </span>中的任何内容被修改，校验和就不对了，达到了防篡改的效果。所以最终<span lang="EN-US">LTPA
Cookie</span>所得到的值为以下公式组成：<span lang="EN-US"><o:p></o:p></span></span>

**<span lang="EN-US" style="font-size:10.5pt;
font-family:宋体;mso-bidi-font-family:宋体;color:#666666">SHA-1=LTPA</span>****<span style="font-size:10.5pt;font-family:宋体;mso-bidi-font-family:宋体;color:#666666">版本号<span lang="EN-US">+</span>创建时间<span lang="EN-US">+</span>过期时间<span lang="EN-US">+</span>用户名<span lang="EN-US">+Domino LTPA </span>密钥</span>**<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

**<span lang="EN-US" style="font-size:10.5pt;
font-family:宋体;mso-bidi-font-family:宋体;color:#666666">LTPA Cookie= Base64(LTPA</span>****<span style="font-size:10.5pt;font-family:宋体;mso-bidi-font-family:宋体;color:#666666">版本号<span lang="EN-US">+</span>创建时间<span lang="EN-US">+</span>过期时间<span lang="EN-US">+</span>用户名<span lang="EN-US">+SHA-1)</span></span>**<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>
<div class="MsoNormal" align="center" style="margin:0cm;margin-bottom:.0001pt;
text-align:center;line-height:18.0pt;word-break:break-all"><span lang="EN-US" style="font-size:10.5pt;color:#666666">

* * *
</span></div>

**<span lang="EN-US" style="font-size:12.5pt;color:#666666">1.2 </span>****<span style="font-size:12.5pt;color:#666666">异构系统所需信息<span lang="EN-US"><o:p></o:p></span></span>**

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span lang="EN-US" style="font-size:10.5pt;
color:#666666">Domino </span><span style="font-size:10.5pt;color:#666666">所使用的<span lang="EN-US">DNS</span>域，如：<span lang="EN-US">vgolive.com<o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span style="font-size:10.5pt;color:#666666">过期时间<span lang="EN-US">(</span>分钟<span lang="EN-US">)</span>，如：<span lang="EN-US">30<o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span lang="EN-US" style="font-size:10.5pt;
color:#666666">Domino LTPA </span><span style="font-size:10.5pt;color:#666666">密钥<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol;color:#666666">·<span style="font-size: 7pt; line-height: normal; font-family: 'Times New Roman';"></span></span><span lang="EN-US" style="font-size:10.5pt;
color:#666666">Domino</span><span style="font-size:10.5pt;color:#666666">验证字名称，如：<span lang="EN-US">/O=VGOLive Technology <o:p></o:p></span></span>

<span style="font-size:10.5pt;color:red">注：用户名可以通过<span lang="EN-US">Domino</span>验证字进行拼接，如异构系统中用户名为<span lang="EN-US">SquallZhong</span>，相应在<span lang="EN-US">Domino</span>中的<span lang="EN-US">DN</span>就是<span lang="EN-US">CN=SquallZhong/O=VGOLive
Technology</span>。此类情况仅限于<span lang="EN-US">Domino</span>中的<span lang="EN-US">CN</span>与异构系统中的用户名一致。如果不一致，需要异构系统做用户对应</span><span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>
<div class="MsoNormal" align="center" style="margin:0cm;margin-bottom:.0001pt;
text-align:center;line-height:18.0pt;word-break:break-all"><span lang="EN-US" style="font-size:10.5pt;color:#666666">

* * *
</span></div>

**<span lang="EN-US" style="font-size:12.5pt;color:#666666">1.3 </span>****<span style="font-size:12.5pt;color:#666666">实现<span lang="EN-US"><o:p></o:p></span></span>**

<span lang="EN-US" style="font-size:10.5pt;color:#666666">Base64</span><span style="font-size:10.5pt;color:#666666">解码<span lang="EN-US">/</span>编码所需<span lang="EN-US">Jar</span>包：**<span lang="EN-US" style="font-family:宋体;
mso-bidi-font-family:宋体">apache-commons-codec-1.3.jar</span>****<span style="font-family:宋体;mso-bidi-font-family:宋体">以上</span>**<span lang="EN-US"><o:p></o:p></span></span>

<span lang="EN-US" style="font-size:10.5pt;color:#666666">SHA-1</span><span style="font-size:10.5pt;color:#666666">的校验使用**<span lang="EN-US" style="font-family:宋体;mso-bidi-font-family:宋体">java.security.MessageDigest</span>**类<span lang="EN-US"><o:p></o:p></span></span>

<span style="font-size:10.5pt;color:#666666">转换字符集使用：**<span lang="EN-US" style="font-family:宋体;mso-bidi-font-family:宋体">Cp850</span>**<span lang="EN-US"><o:p></o:p></span></span>
<div class="MsoNormal" align="center" style="margin:0cm;margin-bottom:.0001pt;
text-align:center;line-height:18.0pt;word-break:break-all"><span lang="EN-US" style="font-size:10.5pt;color:#666666">

* * *
</span></div>

**<span lang="EN-US" style="font-size:11.5pt;color:#333333">1.3.1 </span>****<span style="font-size:11.5pt;color:#333333">解析<span lang="EN-US"><o:p></o:p></span></span>**

<span lang="EN-US" style="font-size:10.5pt;
color:#666666">[<span style="color:#F03331;text-decoration:none;text-underline:
none">show source</span>](http://www.cnblogs.com/hannover/admin/javascript:%20return%20false; "show source")<o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">01</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">import</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">org.apache.commons.codec.binary.Base64;
</span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">02…... </span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">03</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">final</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String CHARSET = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">"Cp850"</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">04</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] dominoSecret =
Base64.decodeBase64(ltpaDominoSecret.getBytes()); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">05</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] ltpa =
Base64.decodeBase64(ltpaToken.getBytes()); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">06ByteArrayInputStream stream = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ByteArrayInputStream(ltpa); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">07</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">int</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">usernameLength = ltpa.length
– </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;
color:#666666">40</span></span>`<span lang="EN-US" style="font-size:12.0pt;
color:#666666">; </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">08</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">header[] = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">4</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">]; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">09</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">creation[] = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">8</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">]; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">10</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">expires[] = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">8</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">]; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">11</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">username[] = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[usernameLength]; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">12</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] sha = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">20</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">]; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">13// </span>``<span style="font-size:12.0pt;
color:#666666">读取<span lang="EN-US">LTPAToken</span>版本号 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">14stream.read(header, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">4</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">15</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">if</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">(header[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">] != </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">|| header[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">1</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">] != </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">1</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">|| header[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">2</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">] != </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">2</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">|| header[</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">3</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">] != </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">3</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">) </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">16</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">throw</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">IllegalArgumentException(</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">"Invalid
ltpaToken format"</span></span>`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">17</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">读取开始时间 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">18</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">stream.read(creation, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">8</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">19</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">读取到期时间 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">20</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">stream.read(expires, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">8</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">21</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">读取<span lang="EN-US">Domino</span>用户<span lang="EN-US">DN </span></span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">22</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">stream.read(username, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, usernameLength); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">23</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">读取<span lang="EN-US">SHA</span>校验和 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">24</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">stream.read(sha, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">20</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">25</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">转换用户名 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">26</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">char</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">characters[] = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">char</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[usernameLength]; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">27</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">try</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">{ </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">28</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">InputStreamReader isr = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">InputStreamReader( </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">29</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ByteArrayInputStream(username),
</span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">30</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">CHARSET); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">31</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">isr.read(characters); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">32</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">} </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">catch</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">(Exception e) { </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">33</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">} </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">34</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">获得<span lang="EN-US">Domino</span>用户<span lang="EN-US">DN </span></span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">35</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String dn = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String(characters); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">36</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">获得创建时间 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">37</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">Date creationDate = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">Date( </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">38</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">Long.parseLong(</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String(creation), </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">16</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">) * </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">1000</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">39</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">获得到期时间 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">40</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">Date expiresDate = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">Date( </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">41</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">Long.parseLong(</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String(expires), </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">16</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">) * </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">1000</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">42…... </span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">43// </span>``<span style="font-size:12.0pt;
color:#666666">创建<span lang="EN-US">LTPA Token </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">44</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ByteArrayOutputStream ostream
= </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;
color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ByteArrayOutputStream(); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">45</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">try</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">{ </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">46</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// LTPA Token</span>``<span style="font-size:12.0pt;color:#666666">版本号 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">47</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ostream.write(header); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">48</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">创建时间 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">49</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ostream.write(creation); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">50</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">过期时间 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">51</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ostream.write(expires); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">52</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// Domino</span>``<span style="font-size:12.0pt;color:#666666">用户<span lang="EN-US">DN</span>，如<span lang="EN-US">CN=SquallZhong/O=DigiWin </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">53</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ostream.write(username); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">54</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// Domino LTPA </span>``<span style="font-size:12.0pt;color:#666666">密钥 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">55</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ostream.write(dominoSecret); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">56</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ostream.close(); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">57</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">} </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">catch</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">(IOException e) { </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">58</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">throw</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">RuntimeException(e); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">59</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">} </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">60</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">进行<span lang="EN-US"> SHA-1 </span>校验和 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">61</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">MessageDigest md; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">62</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">try</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">{ </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">63</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">md =
MessageDigest.getInstance(</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">"SHA-1"</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">64</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">md.reset(); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">65</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">} </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">catch</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">(NoSuchAlgorithmException e)
{ </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">66</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">throw</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">RuntimeException(e); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">67</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">} </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">68</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] digest =
md.digest(ostream.toByteArray()); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">69</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">完成<span lang="EN-US"> SHA-1 </span>校验和，<span lang="EN-US">digest</span>长度为<span lang="EN-US">20 </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">70</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">boolean</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">valid =
MessageDigest.isEqual(digest, sha);</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666"> </span></span><span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>
<div class="MsoNormal" align="center" style="margin:0cm;margin-bottom:.0001pt;
text-align:center;line-height:18.0pt;word-break:break-all"><span lang="EN-US" style="font-size:10.5pt;color:#666666">

* * *
</span></div>

**<span lang="EN-US" style="font-size:11.5pt;color:#333333">1.3.2 </span>****<span style="font-size:11.5pt;color:#333333">生成<span lang="EN-US"><o:p></o:p></span></span>**

<span lang="EN-US" style="font-size:10.5pt;
color:#666666">[<span style="color:#F03331;text-decoration:none;text-underline:
none">show source</span>](http://www.cnblogs.com/hannover/admin/javascript:%20return%20false; "show source")<o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">01</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">/** </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">02</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* </span>``<span style="font-size:12.0pt;color:#666666">为指定用户创建有效的<span lang="EN-US">LTPA Token.</span>创建时间为<span lang="EN-US">&lt;tt&gt;now&lt;/tt&gt;. </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">03</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">04</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* @param username </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">05</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-
</span>``<span style="font-size:12.0pt;color:#666666">用户名，注：使用用户全称，如：<span lang="EN-US">CN=SquallZhong/O=VGOLive Technology </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">06</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* @param creationTime </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">07</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-
</span>``<span style="font-size:12.0pt;color:#666666">创建时间 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">08</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* @param durationMinutes </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">09</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-
</span>``<span style="font-size:12.0pt;color:#666666">到期时间，单位：分钟 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">10@param ltpaSecretStr </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">11</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-
Domino Ltpa </span>``<span style="font-size:12.0pt;color:#666666">加密字符串
</span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">12</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* @return - </span>``<span style="font-size:12.0pt;color:#666666">返回已<span lang="EN-US">Base64</span>编码的<span lang="EN-US">Ltpa Cookie. </span></span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">13</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* @throws
NoSuchAlgorithmException </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">14</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">* @throws
Base64DecodeException </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">15</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp; </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">*/</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">16</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">public</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">static</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String createLtpaToken(String
username, </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">17</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">GregorianCalendar
creationTime, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">int</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">durationMinutes, </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">18</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String ltpaSecretStr) </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">throws</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">NoSuchAlgorithmException { </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">19</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// Base64</span>``<span style="font-size:12.0pt;color:#666666">解码<span lang="EN-US">ltpaSecretStr </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">20</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] ltpaSecret =
Base64.decodeBase64(ltpaSecretStr.getBytes()); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">21</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">用户名字节数组 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">22</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] usernameArray =
username.getBytes(); </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">23</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] workingBuffer = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[preUserDataLength </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">24</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">+ usernameArray.length +
ltpaSecret.length]; </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">25&nbsp;</span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">26</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">设置<span lang="EN-US">ltpaToken</span>版本至<span lang="EN-US">workingBuffer </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">27</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">System.arraycopy(ltpaTokenVersion,
</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;
color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;
color:#666666">, workingBuffer, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">28</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">ltpaTokenVersion.length); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">29</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">获得过期时间，过期时间<span lang="EN-US">=</span>当前时间<span lang="EN-US">+</span>到期时间<span lang="EN-US">(</span>分钟<span lang="EN-US">) </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">30</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">GregorianCalendar
expirationDate = (GregorianCalendar) creationTime </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">31</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">.clone(); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">32</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">expirationDate.add(Calendar.MINUTE,
durationMinutes); </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">33&nbsp;</span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">34</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">转换创建时间至<span lang="EN-US">16</span>进制字符串 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">35</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String hex = dateStringFiller
</span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">36</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">+ Integer.toHexString( </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">37</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">(</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">int</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">)
(creationTime.getTimeInMillis() / </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">1000</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">)) </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">38</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">.toUpperCase(); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">39</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">设置创建时间至<span lang="EN-US">workingBuffer </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">40</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">System.arraycopy(hex.getBytes(),
hex.getBytes().length </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">41</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">- dateStringLength,
workingBuffer, creationDatePosition, </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">42</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">dateStringLength); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">43&nbsp;</span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">44</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">转换过期时间至<span lang="EN-US">16</span>进制字符串 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">45</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">hex = dateStringFiller </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">46</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">+ Integer.toHexString( </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">47</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">(</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">int</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">)
(expirationDate.getTimeInMillis() / </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">1000</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">)) </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">48</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">.toUpperCase(); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">49</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">设置过期时间至<span lang="EN-US">workingBuffer </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">50</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">System.arraycopy(hex.getBytes(),
hex.getBytes().length </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">51</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">- dateStringLength,
workingBuffer, expirationDatePosition, </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">52</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">dateStringLength); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">53&nbsp;</span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">54</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">设置用户全称至<span lang="EN-US">workingBuffer </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">55</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">System.arraycopy(usernameArray,
</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;
color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;
color:#666666">, workingBuffer, preUserDataLength, </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">56</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">usernameArray.length); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">57&nbsp;</span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">58</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">设置已<span lang="EN-US">Base64</span>解码<span lang="EN-US">ltpaSecret</span>至<span lang="EN-US">workingBuffer </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">59</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">System.arraycopy(ltpaSecret, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, workingBuffer, preUserDataLength
</span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">60</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">+ usernameArray.length,
ltpaSecret.length); </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">61</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">创建<span lang="EN-US">Hash</span>字符串 </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">62</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] hash =
createHash(workingBuffer); </span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">63&nbsp;</span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">64</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// ltpaToken</span>``<span style="font-size:12.0pt;color:#666666">版本<span lang="EN-US">+</span>开始时间<span lang="EN-US">(16</span>进制<span lang="EN-US">)+</span>到期时间<span lang="EN-US">(16</span>进制<span lang="EN-US">)+</span>用户全名<span lang="EN-US">+SHA-1(ltpaToken</span>版本<span lang="EN-US">+</span>开始时间<span lang="EN-US">(16</span>进制<span lang="EN-US">)+</span>到期时间<span lang="EN-US">(16</span>进制<span lang="EN-US">)+</span>用户全名<span lang="EN-US">) </span></span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">65</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[] outputBuffer = </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">byte</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">[preUserDataLength +
usernameArray.length </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">66</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">+ hashLength]; </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">67</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">System.arraycopy(workingBuffer,
</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;
color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;
color:#666666">, outputBuffer, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, preUserDataLength </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">68</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">+ usernameArray.length); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">69</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">System.arraycopy(hash, </span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">0</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">, outputBuffer,
preUserDataLength </span>`<span lang="EN-US" style="font-size:10.5pt;
color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">70</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">+ usernameArray.length,
hashLength); </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">71</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">// </span>``<span style="font-size:12.0pt;color:#666666">返回已<span lang="EN-US">Base64</span>编码的<span lang="EN-US">outputBuffer </span></span>`<span lang="EN-US" style="font-size:
10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">72</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">return</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span><span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666">new</span></span><span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666"> </span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">String(Base64.encodeBase64(outputBuffer));
</span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">73</span>`<span class="block"><span lang="EN-US" style="font-size:10.5pt;color:#666666">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>`<span lang="EN-US" style="font-size:12.0pt;color:#666666">} </span>`<span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">74…...</span>`<span class="block"><span lang="EN-US" style="font-size:12.0pt;color:#666666"> </span></span><span lang="EN-US" style="font-size:10.5pt;color:#666666"><o:p></o:p></span>

`<span lang="EN-US" style="font-size:
12.0pt;color:#666666">
</span>`

<font color="#666666" face="monospace" size="3">本文与同事在2013年设计一级部署系统架构时所定，同事曾经发表于[百度文库](http://wenku.baidu.com/link?url=PeEZDCBIhZjTEQffdDMbBvMdpJGaW-WuLNhiJeLwf4jPh-om0Z8bRwNY_LDJiVd0ZqDHyUQ-D9C-WlTGhAVGZ2oma4AU2-tcD-u1JLuN3ne)</font>

<font color="#666666" face="monospace" size="3">
</font>

<font color="#666666" face="monospace" size="3">
</font>

<font color="#666666" face="monospace" size="3">
</font>

<font color="#666666" face="monospace" size="3">
</font>

<font color="#666666" face="monospace" size="3">
</font>
