---
title: 【系统架构】跨域解决方案汇总
id: 245
categories:
  - 系统架构
date: 2014-09-04 18:21:38
tags:
---

## 系统首页架构经典系列—跨域解决方案汇总
<div>
</div><div>1.什么是跨域？</div><div>&nbsp; &nbsp; &nbsp; —1.1 同源策略</div><div>&nbsp; &nbsp; &nbsp; —1.2&nbsp;<span data-wiz-span="data-wiz-span">同源策略规则</span></div><div>2.解决跨域之间的数据交互</div><!--more--><div>&nbsp; &nbsp; &nbsp; —2.1&nbsp;<span style="font-size: 1.2em; font-family: 宋体; line-height: 1.3em;">document.domain+iframe</span></div><div>&nbsp; &nbsp; &nbsp; —2.2&nbsp;<span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 28px;">动态脚本注入</span></div><div>&nbsp; &nbsp; &nbsp; —2.3&nbsp;<span style="font-size: 10.5pt; line-height: 1.5;">跨域代理</span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 28px;">
</span></div><div><span style="font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-size: 10.5pt; line-height: 1.5;">—2.4 JSONP的形式</span></div><div>&nbsp; &nbsp; &nbsp; —2.5 使用HTML5 postMessage</div><div>3.<span style="font-size: 10.5pt; line-height: 1.5;">在首页展现架构中实际应用</span></div><div>&nbsp; &nbsp; &nbsp;—3.1 运用嵌套<span style="font-family: 宋体; font-size: 16.799999237060547px; line-height: 21.837499618530273px;">iframe</span>
</div><div>&nbsp; &nbsp; &nbsp;—3.2 运用<span style="font-size: 10.5pt; line-height: 1.5;">JSONP</span><span style="font-family: 宋体; font-size: 16.799999237060547px; line-height: 21.837499618530273px;">
</span></div><div><span style="font-family: 宋体; font-size: 16.799999237060547px; line-height: 21.837499618530273px;">&nbsp;&nbsp;</span></div>

## 1.什么是跨域？
<div><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Tahoma, Arial, 宋体, sans-serif; font-size: 14px; line-height: 21px; text-indent: 28px;">跨域，简单地理解就是因为JavaScript同源策略的限制，a.com 域名下的js无法操作b.com或是c.a.com域名下的对象</span>&nbsp;<span style="font-size: 10.5pt; line-height: 1.5; text-indent: 2em;">所谓同源是指，域名，协议，端口相同。</span><span style="font-size: 10.5pt; line-height: 1.5; text-indent: 2em;">当一个浏览器的两个</span></div><div><span style="font-size: 10.5pt; line-height: 1.5; text-indent: 2em;">tab页中分别打开来 百度和谷歌的页面</span><span style="font-size: 10.5pt; line-height: 1.5; text-indent: 2em;">当浏览器的百度tab页执行一个脚本的时候会检查这个脚本是属于哪个页面的，</span><span style="font-size: 10.5pt; line-height: 1.5; text-indent: 2em;">即检查是否同源，只有和百度同源的脚本才会被执行。</span><span style="font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; &nbsp;</span></div><div><span style="font-size: 10.5pt; line-height: 1.5;">以下是维基百科上的解释</span></div>

### 1.1同源策略
<div>In&nbsp;[computing](http://en.wikipedia.org/wiki/Computing "Computing"), the&nbsp;<font color="#252525" face="sans-serif"><span style="font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(255, 255, 255);">same-origin policy</span></font>&nbsp;is an important concept in the&nbsp;[web application](http://en.wikipedia.org/wiki/Web_application "Web application")&nbsp;[security model](http://en.wikipedia.org/wiki/Computer_security_model "Computer security model"). The policy permits scripts running on pages originating from the same site&nbsp;</div><div>– a combination of&nbsp;[scheme](http://en.wikipedia.org/wiki/URI_scheme "URI scheme"),&nbsp;[hostname](http://en.wikipedia.org/wiki/Hostname "Hostname"), and&nbsp;[port number](http://en.wikipedia.org/wiki/Port_(computer_networking) "Port (computer networking)")[[1]](http://en.wikipedia.org/wiki/Same-origin_policy#cite_note-w3c_sop-1)<span style="unicode-bidi: -webkit-isolate;">&nbsp;– to access each other's&nbsp;</span>[DOM](http://en.wikipedia.org/wiki/Document_Object_Model "Document Object Model")<span style="unicode-bidi: -webkit-isolate;">&nbsp;with no specific restrictions, but prevents access to&nbsp;</span>[DOM](http://en.wikipedia.org/wiki/Document_Object_Model "Document Object Model")<span style="unicode-bidi: -webkit-isolate;">&nbsp;on different sites.</span>[[1]](http://en.wikipedia.org/wiki/Same-origin_policy#cite_note-w3c_sop-1)<span style="unicode-bidi: -webkit-isolate;">&nbsp;
The same-origin policy also applies to&nbsp;</span>[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest "XMLHttpRequest")<span style="unicode-bidi: -webkit-isolate;">&nbsp;and to&nbsp;</span>[WebSocket](http://en.wikipedia.org/wiki/WebSocket "WebSocket")<span style="unicode-bidi: -webkit-isolate;">.</span></div>

### 1.2 同源策略规则
<div><span style="font-size: 10.5pt; line-height: 1.5;">To illustrate, the following table gives an overview of typical outcomes for checks against the </span>[URL](http://en.wikipedia.org/wiki/Uniform_Resource_Locator "Uniform Resource Locator")<span style="font-size: 10.5pt; line-height: 1.5;"> "http://www.example.com/dir/page.html".</span></div><div>
<table class="wikitable" style="font-size: 14px; margin: 1em 0px; border: 1px solid rgb(170, 170, 170); border-collapse: collapse; font-family: sans-serif; line-height: 22.3999996185303px; background-color: rgb(249, 249, 249);"><tbody><tr><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; text-align: center; background-color: rgb(242, 242, 242);">Compared URL</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; text-align: center; background-color: rgb(242, 242, 242);">Outcome</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; text-align: center; background-color: rgb(242, 242, 242);">Reason</th></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">**http://www.example.com**/dir/page2.html</td><td class="table-yes" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(153, 255, 153);">Success</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Same protocol and host</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">**http://www.example.com**/dir2/other.html</td><td class="table-yes" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(153, 255, 153);">Success</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Same protocol and host</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">**http://**username:password@**www.example.com**/dir2/other.html</td><td class="table-yes" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(153, 255, 153);">Success</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Same protocol and host</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">http://www.example.com:**81**/dir/other.html</td><td class="table-no" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(255, 153, 153);">Failure</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Same protocol and host but different port 端口不同</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">**https**://www.example.com/dir/other.html</td><td class="table-no" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(255, 153, 153);">Failure</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Different protocol 协议不同</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">http://**en.example.com**/dir/other.html</td><td class="table-no" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(255, 153, 153);">Failure</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Different host 仅主域名相同</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">http://**example.com**/dir/other.html</td><td class="table-no" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(255, 153, 153);">Failure</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Different host (exact match required)</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">http://**v2.www.example.com**/dir/other.html</td><td class="table-no" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; vertical-align: middle; text-align: center; background: rgb(255, 153, 153);">Failure</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Different host (exact match required)</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">http://www.example.com:**80**/dir/other.html</td><td class="table-na" style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; color: grey; vertical-align: middle; text-align: center; background: rgb(236, 236, 236);"><small>Depends</small></td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;">Port explicit. Depends on implementation in browser.

</td></tr></tbody></table>

## 2.解决跨域之间的数据交互
<div>以下总结了5种解决跨域之间数据交互的策略，<span style="font-family: 宋体; font-size: 16.799999237060547px; line-height: 21.837499618530273px;">document.domain+iframe、</span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: 宋体; line-height: 28px; text-indent: 28px; font-size: 10.5pt;">动态脚本注入、</span><span style="font-size: 10.5pt; line-height: 1.5;">跨域代理、</span><span style="font-size: 10.5pt; line-height: 1.5;">JSONP的形式、</span><span style="font-size: 10.5pt; line-height: 1.5;">使用HTML5 postMessage</span></div><div><span style="font-size: 10.5pt; line-height: 1.5;">其中JSONP的是原理和动态脚本注入的原理一致</span></div>

### **2.1 document.domain+iframe**
<div>

对于主域相同而子域不同的例子，可以通过设置document.domain的办法来解决。<span style="text-indent: 2em;">举www.a.test.com/a.html和</span><span style="text-indent: 28px; font-size: 10.5pt; line-height: 1.5;">www.b.test.com/b.html</span><span style="text-indent: 2em; font-size: 10.5pt; line-height: 1.5;">为例，只需在a.html中添加一个b.html的iframe，</span>

<span style="text-indent: 2em;"> 并且设置两个页面的document.domain都为'a.com'（只能为主域名），两个页面之间即可互相访问了，代码如下：</span>

<span style="text-indent: 28px; font-size: 10.5pt; line-height: 1.5;">a.htm可以</span>选择动态生成<span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt; background-color: rgb(247, 247, 249);">iframe，也可以选择在</span><span style="font-size: 10.5pt; line-height: 1.5;">a.html</span>用<span style="background-color: rgb(247, 247, 249); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">iframe</span><span style="font-size: 10.5pt; line-height: 1.5;">直接引用b页面</span>

I.采用动态创建<span style="background-color: rgb(247, 247, 249); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">iframe的形式 </span><span style="text-indent: 28px; font-size: 10.5pt; line-height: 1.5;">a.htm的js中填写</span>
<pre class="prettyprint linenums prettyprinted">

1.  `<span class="pln">document</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">=</span><span class="str">'a.com'</span><span class="pun">;</span>`
2.  `<span class="kwd">var</span><span class="pln"> ifr </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'iframe'</span><span class="pun">);</span>`
3.  `<span class="pln">ifr</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> </span><span class="str">'<span style="color: rgb(0, 0, 0); font-family: Arial; line-height: 16.799999237060547px; text-indent: 28px; white-space: normal;">www.b.test.com/b.html</span>'</span><span class="pun">;</span>`
4.  `<span class="pln">ifr</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">'none'</span><span class="pun">;</span>`
5.  `<span class="pln">document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">ifr</span><span class="pun">);</span>`
6.  `<span class="pln">ifr</span><span class="pun">.</span><span class="pln">onload </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span>`
7.  `<span class="pln">  </span><span class="kwd">var</span><span class="pln"> doc </span><span class="pun">=</span><span class="pln"> ifr</span><span class="pun">.</span><span class="pln">contentDocument </span><span class="pun">||</span><span class="pln"> ifr</span><span class="pun">.</span><span class="pln">contentWindow</span><span class="pun">.</span><span class="pln">document</span><span class="pun">;</span>`
8.  `<span class="pln">  </span><span class="com">// 在这里操纵b.html</span>`
9.  `<span class="pln">  alert</span><span class="pun">(</span><span class="pln">doc</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"test"</span><span class="pun">).</span><span class="pln">innerHTML</span><span class="pun">);</span>`
10.  `<span class="pun">};</span>`</pre>

<span style="font-size: 10.5pt; line-height: 1.5;">II采用直接引用</span><span style="background-color: rgb(247, 247, 249); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">iframe的形式</span><span style="background-color: rgb(247, 247, 249); color: rgb(221, 17, 68); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;"> </span><span style="text-indent: 28px; font-size: 10.5pt; line-height: 1.5;">a.htm的内容</span>
<div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="dec">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span>`
2.  `<span class="tag">&lt;html&gt;</span>`
3.  `<span class="tag">&lt;head&gt;</span>`
4.  `<span class="tag">&lt;title&gt;&lt;/title&gt;</span>`
5.  `<span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span>`
6.  `<span class="pln">  document</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">=</span><span class="str">'test.com'</span><span class="pun">;</span>`
7.  `<span class="tag">&lt;/script&gt;</span>`
8.  `<span class="tag">&lt;/head&gt;</span>`
9.  `<span class="tag">&lt;body&gt;</span>`
10.  `<span class="tag">&lt;iframe src ="www.b.test.com/b.html"</span><span class="pln">  </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"solrIframe" style ="display:none" </span><span class="tag">&gt;</span><span class="tag">&lt;/iframe&gt;</span>`
11.  `<span class="tag">&lt;/body&gt;</span>`
12.  `<span class="tag">&lt;/html&gt;</span>`</pre></div>

<span style="font-size: 10.5pt; line-height: 1.5;">http://</span><span style="font-size: 10.5pt; line-height: 1.5;">www.c.</span>a.com/b.html
<div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="dec">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span>`
2.  `<span class="tag">&lt;html&gt;</span>`
3.  `<span class="tag">&lt;head&gt;</span>`
4.  `<span class="tag">&lt;title&gt;&lt;/title&gt;</span>`
5.  `<span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span>`
6.  `<span class="pln">  document</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">=</span><span class="str">'a.com'</span><span class="pun">;</span>`
7.  `<span class="tag">&lt;/script&gt;</span>`
8.  `<span class="tag">&lt;/head&gt;</span>`
9.  `<span class="tag">&lt;body&gt;</span>`
10.  `<span class="tag">&lt;h1</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"test"</span><span class="tag">&gt;</span><span class="pln">Hello World</span><span class="tag">&lt;/h1&gt;</span>`
11.  `<span class="tag">&lt;/body&gt;</span>`
12.  `<span class="tag">&lt;/html&gt;</span>`</pre></div>

如果b.html要访问a.html，可在子窗口（iframe）中通过window.parent来访问父窗口的window对象，然后就可以为所欲为了（window对象都有了，还有啥不行的），同理子窗口也可以和子窗口之间通信。

<span style="font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);"><font color="#ff0000">我们可以通过b.html的XMLHttpRequest来获取数据，再传给a.html，从而解决跨子域获取数据的问题。</font></span>

<dt style="margin: 0px; padding: 0px; font-weight: bold; color: rgb(51, 51, 51); font-family: Tahoma, Arial, 宋体, sans-serif; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">问题：</dt><dd style="margin: 0px 0px 8px 40px; padding: 0px; color: rgb(51, 51, 51); font-family: Tahoma, Arial, 宋体, sans-serif; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">1、安全性，当一个站点（b.a.com）被攻击后，另一个站点（c.a.com）会引起安全漏洞。</dd><dd style="margin: 0px 0px 8px 40px; padding: 0px; color: rgb(51, 51, 51); font-family: Tahoma, Arial, 宋体, sans-serif; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">2、如果一个页面中引入多个iframe，要想能够操作所有iframe，必须都得设置相同domain。</dd>

### <span style="color: rgb(51, 51, 51); font-family: 宋体; line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);">2.2 动态脚本注入</span>

<span class="highlight" style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); font-family: Tahoma, Arial, 宋体, sans-serif; font-size: 14px; text-indent: 28px; background-color: rgb(255, 255, 255);">浏览器默认禁止了跨域访问，但并不禁止在页面中引用其他域的JS文件，并可以自由执行引入的JS文件中的function（包括操作cookie、Dom等等）</span><span style="color: rgb(51, 51, 51); font-family: Tahoma, Arial, 宋体, sans-serif; font-size: 14px; line-height: 21px; text-indent: 28px; background-color: rgb(255, 255, 255);">。根据这一点，可以方便地通过创建script节点的方法来实现完全</span>

<span style="color: rgb(51, 51, 51); font-family: Tahoma, Arial, 宋体, sans-serif; font-size: 14px; line-height: 21px; text-indent: 28px; background-color: rgb(255, 255, 255);">跨域的通信。具体的做法可以参考YUI的</span>[Get Utility](http://developer.yahoo.com/yui/get/)<span style="color: rgb(51, 51, 51); font-family: 宋体; line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);">
</span>

<span style="color: rgb(51, 51, 51); font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);">这种技术克服了XMLHttpRequest的最大限制，也就是跨域请求数据。直接用JavaScript创建一个新的脚本标签，然后设置它的src属性为不同域的URL。</span>

<span style="color: rgb(51, 51, 51); font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);">www.a.com/a.html中的script</span>

<span style="color: rgb(51, 51, 51); font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);"> </span>
<div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="kwd">var</span><span class="pln"> dynScript </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'script'</span><span class="pun">);</span>`
2.  `<span class="pln">dynScript</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> </span><span class="str">'http://www.b.com/b.js'</span><span class="pun">;</span>`
3.  `<span class="pln">dynScript</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">"type"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"text/javascript"</span><span class="pun">);</span>`
4.  `<span class="pln">document</span><span class="pun">.</span><span class="pln">getElementsByTagName</span><span class="pun">(</span><span class="str">'head'</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">dynScript</span><span class="pun">);</span>`</pre></div><div><span style="color: rgb(221, 17, 68); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">b.js可以选择调用去</span><span style="background-color: rgb(247, 247, 249); color: rgb(221, 17, 68); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">www.b.com服务器中</span><font color="#ff0000"><span style="background-color: rgb(247, 247, 249); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">调用请求并将返回的数据放入</span><span style="background-color: rgb(247, 247, 249); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">dynCallback中，而</span><span style="background-color: rgb(247, 247, 249); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">dynCallback实质处理函数则写在a.html的页面中,然后</span><font face="宋体"><span style="font-size: 10.5pt; line-height: 28px; text-indent: 28px;">www.a.com/a.html</span></font>获取了域名<span style="background-color: rgb(247, 247, 249); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: 18px; white-space: pre; font-size: 10.5pt;">www.b.com</span><span style="font-size: 10.5pt; line-height: 1.5;">上的数据</span></font></div><div><font face="宋体"><span style="line-height: 28px; text-indent: 28px;">a.html</span></font>中<span style="color: rgb(51, 51, 51); font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);">回调函数如下：</span>
</div><div><div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="kwd">function</span><span class="pln"> dynCallback</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span>`
2.  `<span class="pln">  </span><span class="com">//处理www.b.com返回的数据  </span>`
3.  `<span class="pln">  alert</span><span class="pun">(</span><span class="pln">data</span><span class="pun">.</span><span class="pln">content</span><span class="pun">);</span>`
4.  `<span class="pun">}</span>`<span style="color: gray; font-size: 10.5pt; line-height: 1.5; font-family: Arial;">&nbsp;</span></pre></div></div></div>

### **2.3、跨域代理**

一种简单的办法，就是把跨域的工作交给服务器，从后台获取其他站点的数据再返回给前台，也就是[跨域代理（Cross Domain Proxy）](http://developer.yahoo.com/javascript/howto-proxy.html "Use a Web Proxy for Cross-Domain XMLHttpRequest Calls")。这段英文比较简单，就不再翻译，请读者自行理解吧

All modern web browsers impose a security restriction on network connections, which includes calls to XMLHttpRequest. This restriction prevents a script or application from making a connection to any web server other than the one the web page originally came from (Internet Explorer will allow cross-domain requests if the option has been enabled in the preferences). If both your web application and the XML data that application uses come directly from the same server, then you do not run into this restriction.

![](https://rjgeek.github.io/images//2015/12/wpid-4df9d899ffa9c54c20a71fa2ceda54c4_9b75ce9f-fcfa-4011-9710-541eaa67cc12.gif)

If, however, you serve your web application from one web server and you make web service data requests to another server -- for example, to the Yahoo! Web Services -- then the browser prevents the connection from being opened at all. Bummer.

![](https://rjgeek.github.io/images//2015/12/wpid-4df9d899ffa9c54c20a71fa2ceda54c4_493ef814-f231-47b7-b0da-979578ab28ed.gif)

There are a number of solutions to this problem but the most commonly-used one is to install a proxy on your web server. Instead of making your XMLHttpRequest calls directly to the web service, you make your calls to your web server proxy. The proxy then passes the call onto the web service and in return passes the data back to your client application. Because the connection is made to your server, and the data comes back from your server, the browser has nothing to complain about.

![](https://rjgeek.github.io/images//2015/12/wpid-4df9d899ffa9c54c20a71fa2ceda54c4_331413c5-fbe7-46f1-9c64-6b6ad20d0b40.gif)

For security reasons it's a good idea for any proxy you install on your web server should be limited in use. An open proxy that passes on connections to any web site URL is open to abuse. Although it is difficult to limit the connections to your proxy from only your application, you can prevent the proxy from making connections to servers other than those you specify. Hard code the URL to connect to in the proxy itself or provide limited options. This makes the proxy less open and less useful to users other than your client application.

<span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: 宋体; font-size: 14px; line-height: 28px; text-indent: 2em;">这种方法似乎蛮简单的，改动也不太大。不过就是http请求多了些，响应慢了些，服务器的负载重了些</span>

### <span style="text-indent: 0px;">2.4 JSONP的形式</span>

<span style="text-indent: 0px;">JSONP的底层原理实际就是动态创建脚本，</span><span style="background-color: rgb(255, 255, 255); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 21px; text-indent: 0px;">利用script标签绕过同源策略，获得一个类似这样的数据，jsonpcallback是页面存在的回调方法，参数就是想得到的json。</span>

<span style="background-color: rgb(255, 255, 255); font-size: 14px; text-indent: 0px;">按照动态创建脚本的方式，</span><span style="background-color: rgb(255, 255, 255); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 21px; text-indent: 0px;">又要插入script标签，又要定义一个回调，略显麻烦，利用jQuery可以直接得到想要的json数据，同样是上面的jsonp：</span>
<div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="pln">$</span><span class="pun">(</span><span class="str">"#getJsonpByJquery"</span><span class="pun">).</span><span class="pln">click</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span>`
2.  `<span class="pln">    $</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">({</span>`
3.  `<span class="pln">        url</span><span class="pun">:</span><span class="pln"> </span><span class="str">'http://localhost:2701/home/somejsonp'</span><span class="pun">,</span>`
4.  `<span class="pln">        dataType</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jsonp"</span><span class="pun">,</span>`
5.  `<span class="pln">        jsonp</span><span class="pun">:</span><span class="pln"> </span><span class="str">"callback"</span><span class="pun">,</span>`
6.  `<span class="pln">        success</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>`
7.  `<span class="pln">            console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span>`
8.  `<span class="pln">        </span><span class="pun">}</span>`
9.  `<span class="pln">    </span><span class="pun">})</span>`
10.  `<span class="pun">})</span>`</pre></div>

### <span style="text-indent: 0px;">2.5 使用HTML5 postMessage</span>
<div><span style="text-indent: 0px;"><span data-wiz-span="data-wiz-span" style="font-size: 13px;">​</span>
</span></div><div>

HTML5提供了跨文档消息机制（Cross Document Messaging），它提供了跨越frame、tabs或windows通信的能力。

<span style="font-size: 10.5pt; line-height: 1.5;">要接收消息的页面需要添加相应的事件监听器，在消息到来时你可以检测其来源来并判断是否处理。</span>

<span id="more-429" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline;"></span>

浏览器的支持情况：

[![浏览器支持](https://rjgeek.github.io/images//2015/12/wpid-4df9d899ffa9c54c20a71fa2ceda54c4_3874a5e4-680e-465d-bff5-9ce11f296f8b.png "2010-12-15-205541_398x221_scrot")](http://www.grati.org/wp-content/uploads/2010/12/2010-12-15-205541_398x221_scrot.png)

检测浏览器支持：

if (typeof window.postMessage === “undefined”) {
// postMessage not supported in this browser
}

发送消息：

发送消息给另一个页面：
window.postMessage(“Hello, world”, “portal.example.com”);

<span style="font-size: 10.5pt; line-height: 1.5;">发送消息给iframe：</span>

document.getElementsByTagName(“iframe”)[0].contentWindow.postMessage(“Hello, world”,
“chat.example.net”);

监听消息，<span style="background-color: rgb(255, 255, 255); color: rgb(59, 59, 59); font-family: 'Helvetica Neue', Arial, Helvetica, sans-serif; font-size: 13px; line-height: 1.8em; word-spacing: 2px;">首先设置白名单，对接受到的消息进行过滤，只处理信任页面发送的消息。</span>
<div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="kwd">var</span><span class="pln"> originWhiteList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[“</span><span class="pln">portal</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span><span class="pun">”,</span><span class="pln"> </span><span class="pun">“</span><span class="pln">games</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span><span class="pun">”,</span><span class="pln"> </span><span class="pun">“</span><span class="pln">www</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span><span class="pun">”];</span><span class="pln">  </span>`
2.  `<span class="kwd">function</span><span class="pln"> checkWhiteList</span><span class="pun">(</span><span class="pln">origin</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span>`
3.  `<span class="pln">    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">originWhiteList</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span>`
4.  `<span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">origin </span><span class="pun">===</span><span class="pln"> originWhiteList</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span>`
5.  `<span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">  </span>`
6.  `<span class="pln">        </span><span class="pun">}</span><span class="pln">  </span>`
7.  `<span class="pln">    </span><span class="pun">}</span><span class="pln">  </span>`
8.  `<span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">  </span>`
9.  `<span class="pun">}</span><span class="pln">  </span>`
10.  `<span class="kwd">function</span><span class="pln"> messageHandler</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span>`
11.  `<span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">checkWhiteList</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">origin</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span>`
12.  `<span class="pln">        processMessage</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">data</span><span class="pun">);</span><span class="pln">  </span>`
13.  `<span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span>`
14.  `<span class="pln">    </span><span class="com">// ignore messages from unrecognized origins  </span>`
15.  `<span class="pln">    </span><span class="pun">}</span><span class="pln">  </span>`
16.  `<span class="pun">}</span><span class="pln">  </span>`
17.  `<span class="pln">window</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(“</span><span class="pln">message</span><span class="pun">”,</span><span class="pln"> messageHandler</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">  </span>`</pre></div></div></div><div>

## <span style="color: rgb(0, 0, 0); font-family: Arial; line-height: 16.799999237060547px; text-indent: 0px;">3 在首页展现架构中实际应用</span>
<div>在网站的首页设计中既用到了来自SOLR的数据下图的【会议预告】，又用到了来自流程引擎的数据【待办工作】，因此首页在展现数据时用到了如下策略</div><div>![](https://rjgeek.github.io/images//2015/12/wpid-4df9d899ffa9c54c20a71fa2ceda54c4_40542741.png)&nbsp;</div><div>
</div>

### <span style="color: rgb(51, 51, 51); font-size: 10.5pt; text-indent: 2em; line-height: 1.5;">3.1运用嵌套</span><span style="color: rgb(51, 51, 51); font-family: 宋体; text-indent: 2em; font-size: 16.799999237060547px; line-height: 21.837499618530273px;">iframe</span>
<div><span style="color: rgb(51, 51, 51); font-family: 宋体; text-indent: 2em; font-size: 16.799999237060547px; line-height: 21.837499618530273px;">
</span></div>

![](https://rjgeek.github.io/images//2015/12/wpid-4df9d899ffa9c54c20a71fa2ceda54c4_24416574.png)&nbsp;

遇到问题：home在去调用SOLR页面时，<span style="font-size: 10.5pt; line-height: 1.5;">SOLR页面页面并没有完全加载，造成调用失败，</span>

应对策略：在SOLR页面添加标志位，待确认加载完全后，home再去调用，代码如下；

<font face="Verdana, Arial, Helvetica, sans-serif"><span style="line-height: 25.200000762939453px;">home页面中代码如下：</span></font>
<div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="tag">&lt;html&gt;</span><span class="pln"> </span>`
2.  `<span class="tag">&lt;head&gt;</span><span class="pln"> </span>`
3.  `<span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="pln"> </span><span class="tag">&gt;</span>`
4.  `<span class="kwd">var</span><span class="pln"> isChildLoaded</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span><span class="pln"> </span><span class="com">//标志位，判断嵌套的solr页面是否完全加载</span>`
5.  `<span class="pln">displayXmlToPage</span><span class="pun">(</span><span class="pln">resp</span><span class="pun">){</span>`
6.  `<span class="com">//在home页面上展现SOLR返回的数据</span>`
7.  `<span class="pun">}</span>`
8.  `<span class="kwd">if</span><span class="pun">(</span><span class="pln">isChildLoaded</span><span class="pun">){</span>`
9.  `<span class="pln">   getSolrXml</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="com">//执行iframe的上的函数</span>`
10.  `<span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span>`
11.  `<span class="pln">   setTimeOut</span><span class="pun">(</span><span class="pln">getSolrXml</span><span class="pun">,</span><span class="lit">50</span><span class="pun">);</span>`
12.  `<span class="pun">}</span>`
13.  `<span class="tag">&lt;/script&gt;</span><span class="pln"> </span>`
14.  `<span class="tag">&lt;/head&gt;</span><span class="pln"> </span>`
15.  `<span class="tag">&lt;body</span><span class="pln"> </span><span class="tag">&gt;</span>`
16.  `<span class="tag">&lt;iframe</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"${solrSearchURL}/searcher/solr.jsp "</span><span class="pln">  </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"solrIframe"</span><span class="pln">  </span><span class="atn">style</span><span class="pun">=</span><span class="atv">"</span><span class="pln">display</span><span class="pun">:</span><span class="pln">none</span><span class="atv">"</span><span class="tag">&gt;&lt;/iframe</span><span class="pln"> </span><span class="tag">&gt;</span>`
17.  `<span class="tag">&lt;/body&gt;</span><span class="pln"> </span>`
18.  `<span class="tag">&lt;/html&gt;</span>`</pre></div>

<font face="Verdana, Arial, Helvetica, sans-serif"><span style="line-height: 25.200000762939453px;">solr页面如下：</span></font>
<div><pre class="prettyprint linenums prettyprinted">

1.  `<span class="tag">&lt;html&gt;</span><span class="pln"> </span>`
2.  `<span class="tag">&lt;head&gt;</span><span class="pln"> </span>`
3.  `<span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="pln"> </span><span class="tag">&gt;</span>`
4.  `<span class="com">//获取Solr服务器上的数据</span>`
5.  `<span class="kwd">function</span><span class="pln"> getSolrXml</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span><span class="pln"> </span>`
6.  `<span class="pln">          </span><span class="kwd">var</span><span class="pln"> url</span><span class="pun">=</span><span class="str">"http://search.sgcc.com.cn:8088/searcher/SearcherSelectServlet/select"</span><span class="pun">;</span><span class="pln"> </span>`
7.  `<span class="pln">           jQuery</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">({</span><span class="pln"> </span>`
8.  `<span class="pln">                      type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"post"</span><span class="pun">,</span><span class="pln"> </span>`
9.  `<span class="pln">                      url</span><span class="pun">:</span><span class="pln"> url</span><span class="pun">,</span><span class="pln">  </span>`
10.  `<span class="pln">                      data</span><span class="pun">:</span><span class="pln"> encodeURIComponent</span><span class="pun">(</span><span class="pln">data</span><span class="pun">.</span><span class="pln">queryService</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span>`
11.  `<span class="pln">                      async</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span>`
12.  `<span class="pln">                      cache</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span>`
13.  `<span class="pln">                      timeout</span><span class="pun">:</span><span class="pln"> </span><span class="lit">60000</span><span class="pun">,</span><span class="pln"> </span>`
14.  `<span class="pln">                      success</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">resp</span><span class="pun">){</span><span class="pln"> </span>`
15.  `<span class="pln">                                       parent</span><span class="pun">.</span><span class="pln">displayXmlToPage</span><span class="pun">(</span><span class="pln">resp</span><span class="pun">)</span><span class="pln">  </span><span class="com">//回调主页面的函数，在home页面上进行展现 </span>`
16.  `<span class="pln">                      </span><span class="pun">}</span><span class="pln"> </span>`
17.  `<span class="pln">    </span><span class="pun">})</span><span class="pln"> </span>`
18.  `<span class="pun">}</span>`
19.  `<span class="tag">&lt;/script&gt;</span><span class="pln"> </span>`
20.  `<span class="tag">&lt;/head&gt;</span><span class="pln"> </span>`
21.  `<span class="tag">&lt;body</span><span class="pln"> </span><span class="atn">onload</span><span class="pun">=</span><span class="atv">"</span><span class="pln">parent</span><span class="pun">.</span><span class="pln">isChildLoaded </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">测试solr</span><span class="tag">&lt;/body&gt;</span><span class="pln"> </span>`
22.  `<span class="tag">&lt;/html&gt;</span>`</pre></div>

### 3.2 运用<span style="font-size: 10.5pt; line-height: 1.5;">JSONP</span>
<div>

1.jsonp的后台action中处理方式：

public void jsonpMethod (){&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PrintWriter out=null;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jsonmap = new HashMap();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jsonmap.put("successed", true);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String callBack = ""+ callback +"("+ JSONUtil.serialize(jsonmap) +")";&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.setCharacterEncoding("utf-8");&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.setContentType("text/javascript;charset=utf-8");&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.setHeader("Cache-Control", "no-cache");&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; out = response.getWriter();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; out.write(callBack);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throwException(e);&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;
&nbsp;&nbsp;&nbsp; }

&nbsp;

备注：callback 属于前台传来的参数

<div style="color:gray">

jsonp的前台调用形式

var url=[http://log.coa.sgcc.com.cn:8006/coa-webapp/json/jsonpMethod .action](http://log.coa.sgcc.com.cn:8006/coa-webapp/json/getVisitLogBeanList.action)

jQuery.ajax({&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type : "get",&nbsp; //获取形式&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; url : url,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //请求url&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dataType : "jsonp",&nbsp;&nbsp;&nbsp;&nbsp; //标明是jsonp的形式&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jsonpCallback:"callback",&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; async : false,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cache : false,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data: {querycond:querycond},&nbsp; //条件&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success : function(json) {&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(json.list[0].unitName)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;
})
</div><small><small>&nbsp;</small></small></div><div>引用附录</div>来源：&nbsp;&lt;[http://en.wikipedia.org/wiki/Same-origin_policy](http://en.wikipedia.org/wiki/Same-origin_policy)&gt;
<span style="text-indent: 28px;">来源：&nbsp;&lt;</span>[https://developer.yahoo.com/javascript/howto-proxy.html](https://developer.yahoo.com/javascript/howto-proxy.html)<font color="#808080" face="宋体"><span style="line-height: 28px; text-indent: 28px; background-color: rgb(255, 255, 255);">&gt;</span></font>
来源：&nbsp;&lt;[http://www.2cto.com/kf/201111/110813.html](http://www.2cto.com/kf/201111/110813.html)<font color="#808080">&gt;</font></div><div>来源：&lt;[http://www.grati.org/?p=429](http://www.grati.org/?p=429)<font color="#808080" face="Consolas, Courier New, Courier, mono"><span style="line-height: 14px; background-color: rgb(255, 255, 255);">&gt;</span></font></div><div>来源：&nbsp;&lt;[http://www.cnblogs.com/lijiaxuan/](http://www.cnblogs.com/lijiaxuan/)<font color="#808080">&gt;</font></div><div>来源：&nbsp;&lt;[http://www.cnblogs.com/yuzhongwusan/archive/2012/12/11/2812849.html](http://www.cnblogs.com/yuzhongwusan/archive/2012/12/11/2812849.html)<font color="#808080">&gt;<span style="font-size: 12px;"><span style="line-height: 13.600000381469727px;">
</span></span></font>

</div><div>
</div>

<div>[来自为知笔记(Wiz)](http://www.wiz.cn/i/60efacb7 "来自为知笔记(Wiz)")</div>