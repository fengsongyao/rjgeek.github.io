---
title: 【Mongodb】集群分片环境mongodb的版本升级
tags:
  - Mongodb
id: 506
categories:
  - 数据库知识
date: 2015-03-31 07:23:46
---

#### <span style="font-family: 宋体;"><label class="wiz-todo-label wiz-todo-label-unchecked">![](https://rjgeek.github.io/images//2015/03/wpid-dc9805dbb1b814621a2fc31efaab7c96_unchecked.png)背景说明</label></span>

<!--more-->
<div><span style="font-family: 宋体;">生产环境数据量的剧增，鉴于2.6版本优化了存储引擎，提高了写入的速度，特提出了升级Mongo的需求</span></div>
<div><span style="font-family: 宋体;">目前环境中最大的一个集合分为6个片，且每片均有主节点，副节点和仲裁节点，本次升级为不停服务升级，</span></div>
<div><span style="font-family: 宋体;">升级的版本有2.4.10升级至2.6.2版本，特别需要提醒的是升级前请做好备份，升级一旦失败无法回退。</span></div>

#### <span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: &lt;br /&gt;
major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; &lt;br /&gt;
mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;"><label class="wiz-todo-label wiz-todo-label-unchecked">![](https://rjgeek.github.io/images//2015/03/wpid-dc9805dbb1b814621a2fc31efaab7c96_unchecked.png)升级的注意事项</label></span>

#### 

<span lang="EN-US">1.</span><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">升级过程中不允许有以下操作</span>

1.  `<span class="pln">sh</span><span class="pun">.</span><span class="pln">enableSharding</span><span class="pun">()</span>`
2.  <span class="pln" style="line-height: 18px; font-size: 13px;">sh</span><span class="pun" style="line-height: 18px; font-size: 13px;">.</span><span class="pln" style="line-height: 18px; font-size: 13px;">shardCollection</span><span class="pun" style="line-height: 18px; font-size: 13px;">()</span>

3.  <span class="pln" style="line-height: 18px; font-size: 13px;">sh</span><span class="pun" style="line-height: 18px; font-size: 13px;">.</span><span class="pln" style="line-height: 18px; font-size: 13px;">addShard</span><span class="pun" style="line-height: 18px; font-size: 13px;">()</span>

4.  `<span class="pln">db</span><span class="pun">.</span><span class="pln">createCollection</span><span class="pun">()</span>`
5.  `<span class="pln">db</span><span class="pun">.</span><span class="pln">collection</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">()</span>`
6.  `<span class="pln">db</span><span class="pun">.</span><span class="pln">dropDatabase</span><span class="pun">()</span>`
7.  `<span class="pln">any operation that creates a database</span>`
8.  `<span class="pln">any other operation that modifies the cluster metadata in any way</span><span class="pun">.</span><span class="typ">See</span><span class="typ">Sharding</span><span class="typ">Reference</span><span class="kwd">for</span><span class="pln"> a complete list of sharding commands</span><span class="pun">.</span><span class="typ">Note</span><span class="pun">,</span><span class="pln"> however</span><span class="pun">,</span><span class="pln"> that not all commands on the </span><span class="typ">Sharding</span><span class="typ">Reference</span><span class="pln"> page modifies the cluster meta</span><span class="pun">-</span><span class="pln">data</span><span class="pun">.</span>`
<p class="MsoNormal"><span lang="EN-US">2,有</span><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">升级后无法降级</span>

#### <span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: &lt;br /&gt;
major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; &lt;br /&gt;
mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;"><label class="wiz-todo-label wiz-todo-label-unchecked">![](https://rjgeek.github.io/images//2015/03/wpid-dc9805dbb1b814621a2fc31efaab7c96_unchecked.png)升级的步骤</label></span>

<p class="MsoNormal"><span lang="EN-US">1. </span><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">安装，解压到</span><span style="background: yellow; mso-highlight: yellow;" lang="EN-US">/home/Mongo</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">下，关于</span>Mongo集群环境的搭建详见《[【Mongodb】MongoDB分片备份策略与配置迁移示例](http://helloword.1kapp.com/archives/142)》

<p class="MsoNormal"><span lang="EN-US">2. </span><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">建脚本库存放于文件夹</span><span lang="EN-US">script中</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">，脚本库中权限与内容如下</span>
<div>

1.  `<span class="pun">-</span><span class="pln">rwxrwxrwx </span><span class="lit">1</span><span class="typ">Mongo</span><span class="typ">Mongodb</span><span class="lit">179</span><span class="typ">Mar</span><span class="lit">22</span><span class="lit">09</span><span class="pun">:</span><span class="lit">05</span><span class="pln"> startconfig</span><span class="pun">.</span><span class="pln">sh</span>`
2.3.  `<span class="pun">-</span><span class="pln">rwxrwxrwx </span><span class="lit">1</span><span class="typ">Mongo</span><span class="typ">Mongodb</span><span class="lit">191</span><span class="typ">Mar</span><span class="lit">22</span><span class="lit">09</span><span class="pun">:</span><span class="lit">05</span><span class="pln"> startmongos</span><span class="pun">.</span><span class="pln">sh</span>`
4.5.  `<span class="pun">-</span><span class="pln">rwxrwxrwx </span><span class="lit">1</span><span class="typ">Mongo</span><span class="typ">Mongodb</span><span class="lit">169</span><span class="typ">Mar</span><span class="lit">22</span><span class="lit">09</span><span class="pun">:</span><span class="lit">05</span><span class="pln"> startshard1</span><span class="pun">.</span><span class="pln">sh</span>`
6.7.  `<span class="pun">-</span><span class="pln">rwxrwxrwx </span><span class="lit">1</span><span class="typ">Mongo</span><span class="typ">Mongodb</span><span class="lit">169</span><span class="typ">Mar</span><span class="lit">22</span><span class="lit">09</span><span class="pun">:</span><span class="lit">05</span><span class="pln"> startshard2</span><span class="pun">.</span><span class="pln">sh</span>`
8.9.  `<span class="pun">-</span><span class="pln">rwxrwxrwx </span><span class="lit">1</span><span class="typ">Mongo</span><span class="typ">Mongodb</span><span class="lit">169</span><span class="typ">Mar</span><span class="lit">22</span><span class="lit">09</span><span class="pun">:</span><span class="lit">05</span><span class="pln"> startshard3</span><span class="pun">.</span><span class="pln">sh</span>`
</div>
<p class="MsoNormal"><span lang="EN-US">       </span><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">文件中的内容（此处可以选择配置环境变量）</span>
<div>

1.  `**<span class="pln">startconfig</span><span class="pun">.</span><span class="pln">sh</span>**`
2.3.  `<span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="typ">Mongo</span><span class="pun">/</span><span class="pln">mongodb</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="lit">3.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">mongod </span><span class="pun">-</span><span class="pln">configsvr </span><span class="pun">-</span><span class="pln">port </span><span class="lit">20000</span><span class="pun">-</span><span class="pln">fork </span><span class="pun">-</span><span class="pln">dbpath </span><span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="typ">Mongo</span><span class="pun">/</span><span class="pln">mongodb</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="lit">3.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">/</span><span class="pln">config </span><span class="pun">-</span><span class="pln">logpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">dblog</span><span class="pun">/</span><span class="pln">config</span><span class="pun">/</span><span class="pln">config</span><span class="pun">.</span><span class="pln">log </span><span class="pun">--</span><span class="pln">upgrade</span>`
4.5.  `**<span class="pln">startmongos</span><span class="pun">.</span><span class="pln">sh</span>**`
6.7.  `<span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="typ">Mongo</span><span class="pun">/</span><span class="pln">mongodb</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="lit">3.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">mongos </span><span class="pun">-</span><span class="pln">fork </span><span class="pun">-</span><span class="pln">port </span><span class="lit">30000</span><span class="pun">-</span><span class="pln">configdb </span><span class="str">"192.168.199.133:20000,192.168.199.134:20000,192.168.199.135:20000"</span><span class="pun">-</span><span class="pln">logpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">dblog</span><span class="pun">/</span><span class="pln">mongos</span><span class="pun">/</span><span class="pln">mongos</span><span class="pun">.</span><span class="pln">log</span>`
8.9.  `**<span class="pln">startshard1</span><span class="pun">.</span><span class="pln">sh</span>**`
10.11.  `<span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="typ">Mongo</span><span class="pun">/</span><span class="pln">mongodb</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="lit">3.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">mongod </span><span class="pun">-</span><span class="pln">fork </span><span class="pun">-</span><span class="pln">shardsvr </span><span class="pun">-</span><span class="pln">replSet shard1 </span><span class="pun">-</span><span class="pln">port </span><span class="lit">10001</span><span class="pun">-</span><span class="pln">dbpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">db</span><span class="pun">/</span><span class="pln">shard1 </span><span class="pun">-</span><span class="pln">logpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">dblog</span><span class="pun">/</span><span class="pln">shard1</span><span class="pun">/</span><span class="pln">shard1</span><span class="pun">.</span><span class="pln">log</span>`
12.13.  `**<span class="pln">startshard2</span><span class="pun">.</span><span class="pln">sh</span>**`
14.15.  `<span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="typ">Mongo</span><span class="pun">/</span><span class="pln">mongodb</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="lit">3.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">mongod </span><span class="pun">-</span><span class="pln">fork </span><span class="pun">-</span><span class="pln">shardsvr </span><span class="pun">-</span><span class="pln">replSet shard2 </span><span class="pun">-</span><span class="pln">port </span><span class="lit">10002</span><span class="pun">-</span><span class="pln">dbpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">db</span><span class="pun">/</span><span class="pln">shard2 </span><span class="pun">-</span><span class="pln">logpath </span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">dblog</span><span class="pun">/</span><span class="pln">shard2</span><span class="pun">/</span><span class="pln">shard2</span><span class="pun">.</span><span class="pln">log</span>`
16.17.  `**<span class="pln">startshard3</span><span class="pun">.</span><span class="pln">sh</span>**`
18.19.  `<span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="typ">Mongo</span><span class="pun">/</span><span class="pln">mongodb</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="lit">3.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">mongod </span><span class="pun">-</span><span class="pln">fork </span><span class="pun">-</span><span class="pln">shardsvr </span><span class="pun">-</span><span class="pln">replSet shard3 </span><span class="pun">-</span><span class="pln">port </span><span class="lit">10003</span><span class="pun">-</span><span class="pln">dbpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">db</span><span class="pun">/</span><span class="pln">shard3 </span><span class="pun">-</span><span class="pln">logpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">dblog</span><span class="pun">/</span><span class="pln">shard3</span><span class="pun">/</span><span class="pln">shard3</span><span class="pun">.</span><span class="pln">log</span>`
</div>
<p class="MsoNormal"><span style="font-family: Helvetica, sans-serif; color: #313030; background-color: white;" lang="EN-US">3.停止均衡器（</span><span style="background-color: #ffffff; color: #313030; font-family: Helvetica, sans-serif; font-size: 10.5pt; line-height: 1.5;">Disable the Balancer</span><span style="background-color: white; color: #313030; font-family: Helvetica, sans-serif; font-size: 10.5pt; line-height: 1.5;">）.</span>

<span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: &lt;br /&gt;
minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; &lt;br /&gt;
mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">连接到</span><span lang="EN-US">mongos,</span><span style="font-family: 宋体; mso-ascii-font-family: &lt;br /&gt;
Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: &lt;br /&gt;
minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">执行脚本</span>
<div>

1.  `<span class="pun">./</span><span class="pln"> mongos </span><span class="pun">-</span><span class="pln">port </span><span class="lit">30000</span><span class="com">//30000为路由器端口</span>`
2.3.  `<span class="pln">sh</span><span class="pun">.</span><span class="pln">stopBalancer</span><span class="pun">()</span>`
</div>
<p class="MsoListParagraph" style="margin-left: 18.0pt; text-indent: 0cm; mso-char-indent-count: &lt;br /&gt;
0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: &lt;br /&gt;
minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; &lt;br /&gt;
mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">检查是否已经完全停止</span>
<div>

1.  `<span class="pln">use config</span>`
2.3.  `<span class="kwd">while</span><span class="pun">(</span><span class="pln"> sh</span><span class="pun">.</span><span class="pln">isBalancerRunning</span><span class="pun">()</span><span class="pun">)</span><span class="pun">{</span>`
4.  `<span class="pln"> print</span><span class="pun">(</span><span class="str">"waiting..."</span><span class="pun">);</span>`
5.  `<span class="pln"> sleep</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">);</span>`
6.  `<span class="pun">}</span>`<span style="font-size: 10.5pt; line-height: 1.5; font-family: Arial;"> </span>
</div>
<p class="MsoNormal"><span lang="EN-US">4.</span><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">升级分片元数据（配置服务器）</span>

<p class="MsoNormal"><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">    进入mongod节点,运行升级脚本</span>
<div>

1.  `<span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="typ">Mongo</span><span class="pun">/</span><span class="pln">mongodb</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">-</span><span class="lit">3.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">mongos </span><span class="pun">-</span><span class="pln">configdb </span><span class="str">"192.168.199.133:20000,192.168.199.134:20000,192.168.199.135:20000"</span><span class="pun">-</span><span class="pln">logpath </span><span class="pun">/</span><span class="pln">data1</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">dblog</span><span class="pun">/</span><span class="pln">mongos</span><span class="pun">/</span><span class="pln">updatemongos</span><span class="pun">.</span><span class="pln">log </span><span class="pun">—</span><span class="pln">upgrade</span>`
</div>
<p class="MsoListParagraph" style="margin-left: 18.0pt; text-indent: 0cm; mso-char-indent-count: &lt;br /&gt;
0;"><span style="font-size: 10.5pt; line-height: 1.5;">查看</span><span style="background-color: #f7f7f9; color: #48484c; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.076923370361328px; line-height: 17.992788314819336px; white-space: pre;">updatemongos中日志信息</span><span style="font-family: 宋体; font-size: 10.5pt; line-height: 1.5; text-indent: 0cm;">，如果输出以下语句，则表示配置服务器升级成功</span>

<span style="background: yellow; mso-highlight: yellow;" lang="EN-US">upgrade of config
server to v5 successful</span>

<span style="background: yellow; mso-highlight: yellow;" lang="EN-US">Config database is at
version v5</span>

<span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">依次停止旧的配置服务器启动新的配置服务器，备注：升级过程中保至少一台配置服务器正常运转</span>

<p class="MsoNormal"><span lang="EN-US">5.</span><span style="font-family: 宋体; &lt;br /&gt;
mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">升级分片服务（主从节点升级）</span>

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">停止</span><span lang="EN-US">10001</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">的备份服务，启动新服务</span>

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">停止</span><span lang="EN-US">10001</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">的仲裁服务，启动新服务</span>

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">切换</span><span lang="EN-US">10001</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">的主节点到备份服务</span>

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">连接至主节点</span> <span style="font-family: &lt;br /&gt;
宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: &lt;br /&gt;
宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; &lt;br /&gt;
mso-hansi-theme-font: minor-latin;">使用切换命令</span>
<div>

1.  `<span class="pln">rs</span><span class="pun">.</span><span class="pln">stepDown</span><span class="pun">()</span>`
</div>
<div><span style="font-family: 宋体; text-indent: 10.5pt; font-size: 10.5pt; line-height: 1.5;">查看是否切换成功</span></div>
<div>

1.  `<span class="pln">rs</span><span class="pun">.</span><span class="pln">status</span><span class="pun">()</span>`
</div>
<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">依次处理</span><span lang="EN-US">10002</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">节点与</span><span lang="EN-US">10003</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">节点</span>

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span lang="EN-US">WARNING</span><span style="font-family: 宋体; mso-ascii-font-family: &lt;br /&gt;
Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: &lt;br /&gt;
minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：</span><span style="text-indent: 10.5pt; font-size: 10.5pt; line-height: 1.5;">Do not upgrade mongod instances until after you have upgraded all
mongos instances.</span>

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span lang="EN-US">6.</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; &lt;br /&gt;
mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: &lt;br /&gt;
minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">重启主服务，启动</span>**<span style="font-family: 'Helvetica','sans-serif'; color: #313030; &lt;br /&gt;
background: white;" lang="EN-US">Balancer</span>**

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">关闭原来的服务，使用新的脚本启动</span>

<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">下面的脚本启动</span>**<span style="font-family: 'Helvetica','sans-serif'; color: #313030; background: white;" lang="EN-US">Balancer</span>**
<div>

1.  `<span class="pln">sh</span><span class="pun">.</span><span class="pln">setBalancerState</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span>`
</div>
<div><span style="text-indent: 10.5pt; font-size: 10.5pt; line-height: 1.5;" lang="EN-US">7.</span><span style="text-indent: 10.5pt; font-size: 10.5pt; line-height: 1.5; font-family: 宋体;">检查服务是否正常运转</span></div>
<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; &lt;br /&gt;
mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: &lt;br /&gt;
Calibri; mso-hansi-theme-font: minor-latin;">查看版本信息</span>
<div>

1.  `<span class="pln">db</span><span class="pun">.</span><span class="pln">runCommand</span><span class="pun">({</span><span class="str">"buildInfo"</span><span class="pun">:</span><span class="lit">1</span><span class="pun">})</span>`
</div>
<div></div>
<p class="MsoNormal" style="text-indent: 10.5pt; mso-char-indent-count: 1.0;"><span lang="EN-US"> </span>

<div>[来自为知笔记(Wiz)](http://www.wiz.cn/i/60efacb7 "来自为知笔记(Wiz)")</div>