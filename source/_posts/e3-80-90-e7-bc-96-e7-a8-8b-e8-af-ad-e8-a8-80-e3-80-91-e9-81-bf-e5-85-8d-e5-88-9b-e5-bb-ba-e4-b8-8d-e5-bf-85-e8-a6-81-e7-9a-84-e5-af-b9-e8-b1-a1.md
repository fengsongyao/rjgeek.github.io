---
title: 【编程语言】避免创建不必要的对象
id: 820
categories:
  - 编程语言
date: 2015-02-09 22:10:48
tags:
---

<div>编程时重用最好能重用对象，而不是每次需要的时候都去创建一个同样功能的新对象，如果对象是不可变的，则它可以始终被重用</div><div>除了重用那些不可变的对象外，也可以重用那些已知的不会被修改的可变对象，下面举一个常见的例子说明减少创建对象对代码优化</div><div>的重要性</div><div>
</div><div>模型说明：</div><div>其中涉及了可变的Date对象，它的值一旦计算出来就不在改变，下面建立一个模型：其中一个人，并有<span >IsPost90s方法，判断此人是否为90后</span><!--more-->
</div><div><span >模型代码：</span></div><div><font face="Verdana"><span >代码片段一：</span></font></div><div><div><pre >

1.  `<span >/**</span>`
2.  `<span > * 需求：判断此人是否属于属于90后，即出生年在1990年至1999年之间</span>`
3.  `<span > * @author RUJIA_LI</span>`
4.  `<span > *</span>`
5.  `<span > */</span>`
6.  `<span >public</span><span > </span><span >class</span><span > </span><span >Person1</span><span > </span><span >{</span>`
7.  `<span >	</span><span >private</span><span >   </span><span >String</span><span > name</span><span >;</span>`
8.  `<span >	</span><span >private</span><span >   </span><span >Date</span><span > birthDate</span><span >;</span>`
9.  `<span >	</span><span >public</span><span > </span><span >Person1</span><span > </span><span >(</span><span >String</span><span > name</span><span >,</span><span > </span><span >Date</span><span > birthDate </span><span >)</span><span > </span><span >{</span>`
10.  `<span >		</span><span >this</span><span >.</span><span >name      </span><span >=</span><span > name</span><span >;</span>`
11.  `<span >		</span><span >this</span><span >.</span><span >birthDate </span><span >=</span><span > birthDate</span><span >;</span>`
12.  `<span >	</span><span >}</span>`
13.  `<span >	</span><span >public</span><span > </span><span >boolean</span><span > </span><span >IsPost90s</span><span >(){</span>`
14.  `<span >		</span><span >Calendar</span><span > cal </span><span >=</span><span >  </span><span >Calendar</span><span >.</span><span >getInstance</span><span >(</span><span >TimeZone</span><span >.</span><span >getTimeZone</span><span >(</span><span >"GMT"</span><span >));</span>`
15.  `<span >		cal</span><span >.</span><span >set</span><span >(</span><span >1990</span><span >,</span><span > </span><span >Calendar</span><span >.</span><span >JANUARY</span><span >,</span><span > </span><span >1</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >);</span>`
16.  `<span >		</span><span >Date</span><span >  startdate </span><span >=</span><span > cal</span><span >.</span><span >getTime</span><span >();</span>`
17.  `<span >		cal</span><span >.</span><span >set</span><span >(</span><span >1999</span><span >,</span><span > </span><span >Calendar</span><span >.</span><span >JANUARY</span><span >,</span><span > </span><span >1</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >);</span>`
18.  `<span >		</span><span >Date</span><span >  enddate </span><span >=</span><span > cal</span><span >.</span><span >getTime</span><span >();</span>`
19.  `<span >		</span><span >return</span><span > birthDate</span><span >.</span><span >compareTo</span><span >(</span><span >startdate</span><span >)&gt;=</span><span >0</span><span >&amp;&amp;</span><span >birthDate</span><span >.</span><span >compareTo</span><span >(</span><span >enddate</span><span >)&lt;</span><span >0</span><span >;</span>`
20.  `<span >	</span><span >}</span>`<span >	</span>
21.  `<span >}</span>`</pre></div><div><span >IsPost90s()方法每次被调用的时候，都会新建一个</span><span  >Calendar<font color="#48484c">对象，一个</font></span><span >TimeZone对象和两个</span><span  >Date<font color="#48484c">对象，这是非常没有意义的</font></span>
</div><div><span  ><font color="#48484c">下面的版本用了静态初始化器，</font></span></div><div>代码片段二：</div></div>

<!--WizRtf2Html Charset=0  --><div><div><pre >

1.  `<span >/**</span>`
2.  `<span > * 需求：判断此人是否属于属于90后，即出生年在1990年至1999年之间</span>`
3.  `<span > * @author RUJIA_LI</span>`
4.  `<span > *</span>`
5.  `<span > */</span>`
6.  `<span >public</span><span > </span><span >class</span><span > </span><span >Person2</span><span > </span><span >{</span>`
7.  `<span >	</span><span >private</span><span >  </span><span >String</span><span > name</span><span >;</span>`
8.  `<span >	</span><span >private</span><span >  </span><span >Date</span><span >  birthDate</span><span >;</span>`
9.  `<span >	</span><span >private</span><span >  </span><span >static</span><span > </span><span >final</span><span >  </span><span >Date</span><span > START_TIME</span><span >;</span>`
10.  `<span >	</span><span >private</span><span >  </span><span >static</span><span > </span><span >final</span><span >  </span><span >Date</span><span > END_TIME</span><span >;</span>`
11.  `<span >	</span>`
12.  `<span >	</span><span >public</span><span > </span><span >Person2</span><span >(</span><span >String</span><span > name</span><span >,</span><span > </span><span >Date</span><span > birthDate </span><span >)</span><span > </span><span >{</span>`
13.  `<span >		</span><span >this</span><span >.</span><span >name      </span><span >=</span><span > name</span><span >;</span>`
14.  `<span >		</span><span >this</span><span >.</span><span >birthDate </span><span >=</span><span > birthDate</span><span >;</span>`
15.  `<span >	</span><span >}</span>`<span >	</span>
16.  `<span >	</span><span >static</span><span >{</span>`
17.  `<span >		</span><span >Calendar</span><span > cal </span><span >=</span><span >  </span><span >Calendar</span><span >.</span><span >getInstance</span><span >(</span><span >TimeZone</span><span >.</span><span >getTimeZone</span><span >(</span><span >"GMT"</span><span >));</span>`
18.  `<span >		cal</span><span >.</span><span >set</span><span >(</span><span >1990</span><span >,</span><span > </span><span >Calendar</span><span >.</span><span >JANUARY</span><span >,</span><span > </span><span >1</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >);</span>`
19.  `<span >		START_TIME</span><span >=</span><span > cal</span><span >.</span><span >getTime</span><span >();</span>`
20.  `<span >		cal</span><span >.</span><span >set</span><span >(</span><span >1999</span><span >,</span><span > </span><span >Calendar</span><span >.</span><span >JANUARY</span><span >,</span><span > </span><span >1</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >,</span><span > </span><span >0</span><span >);</span>`
21.  `<span >		END_TIME </span><span >=</span><span > cal</span><span >.</span><span >getTime</span><span >();</span>`
22.  `<span >	</span><span >}</span>`
23.  `<span >	</span><span >public</span><span > </span><span >boolean</span><span > </span><span >IsPost90s</span><span >(){</span>`
24.  `<span >		</span><span >return</span><span > birthDate</span><span >.</span><span >compareTo</span><span >(</span><span >START_TIME</span><span >)&gt;=</span><span >0</span><span >&amp;&amp;</span><span >birthDate</span><span >.</span><span >compareTo</span><span >(</span><span >END_TIME</span><span >)&lt;</span><span >0</span><span >;</span>`
25.  `<span >	</span><span >}</span>`<span >	</span>
26.  `<span >}</span>`</pre></div><div>测试结构：</div></div><div><span  >Person1</span><span  >和</span><span  >Person2中的</span><span >IsPost90s方法分别被调用5000万次</span>
</div><div><font color="#008080" face="Consolas, Liberation Mono, Menlo, Courier, monospace" size="2"><span >执行时间对比：</span></font></div><div>

<!--WizRtf2Html Charset=0  --><span >第一种方式耗时152161毫秒</span>&nbsp;&nbsp;<span >
</span></div><div>

<!--WizRtf2Html Charset=0  --><span >第二种方式耗时28761毫秒</span>&nbsp;&nbsp;</div><div>堆栈利用情况：</div><div>第一种方式堆栈使用情况</div><div>![](https://rjgeek.github.io/images/2015/12/wpid-eb7825e5982c7a343aedcd889c4e1bd1_2ef8417d-ae93-49b3-96de-e752f95593af.png)
<div>第一种方式堆栈使用情况
<div>![](https://rjgeek.github.io/images/2015/12/wpid-eb7825e5982c7a343aedcd889c4e1bd1_673b2bfd-62c3-472d-b9d9-fbba44384e11.png)
</div><div>
</div><div>改进后的<span >Person2类在仅在初始化创建</span><span >Calendar、</span><span >TimeZone和</span><span >Date对象一次，而不是每次调用</span><span >IsPost90s的时候创建这些实例，把</span><span >START_TIME和</span></div><div><span >END_TIME从局部变量变为final静态域，当做常量处理，</span><span >从上面的执行时间</span><span >可以看出减少对象的创建可以大幅度提高性能，从堆栈的使用情况可知，</span></div><div><span >频繁的创建的对象加速的虚拟机的GC速度</span></div><div><span >
</span></div><div><span >
</span></div><div>
</div><div>
</div><div>
</div><div>
</div><div>
</div><div>
</div><div>
</div><div>
</div><div>
</div><div>&nbsp;
</div></div></div>

<div>[来自为知笔记(Wiz)](http://www.wiz.cn/i/60efacb7 "来自为知笔记(Wiz)")</div>